[gcode_macro START_PRINT]
description: >
  START_PRINT BED_TEMP=… EXTRUDER_TEMP=… ADAPTIVE=(0|1) SMART_PARK=(0|1) LINE_PURGE=(0|1)
gcode:
  {% set bed_temp      = params.BED_TEMP     |default(60)   |float %}
  {% set extruder_temp = params.EXTRUDER_TEMP|default(200)  |float %}
  {% set adaptive      = params.ADAPTIVE     |default(1)    |int   %}
  {% set smart_park    = params.SMART_PARK   |default(0)    |int   %}
  {% set line_purge    = params.LINE_PURGE   |default(1)    |int   %}

  WAIT_TEMP_END

  M140 S{bed_temp}
  G28
  M190 S{bed_temp}
  G28 Z
  NOZZLE_CLEAR HOT_MAX_TEMP={extruder_temp - 20.0}
  G28 Z

  BED_MESH_CLEAR
  {% if adaptive == 1 %}
    BED_MESH_CALIBRATE ADAPTIVE=1
  {% endif %}

  {% if smart_park == 1 %}
    _SMART_PARK
    M109 S{extruder_temp}
    M190 S{bed_temp}
    {% if line_purge == 1 %}
      _LINE_PURGE
    {% endif %}
  {% else %}
    M109 S{extruder_temp}
    M190 S{bed_temp}
  {% endif %}
